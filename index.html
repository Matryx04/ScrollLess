<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScrolLess Desktop</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animacje */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-[#F8FAFC] text-gray-900 selection:bg-emerald-100 selection:text-emerald-900">

    <canvas id="confetti" class="fixed inset-0 pointer-events-none z-[100]"></canvas>

    <div class="min-h-screen flex">
        <!-- SIDEBAR (DESKTOP) -->
        <aside class="w-64 bg-white border-r border-gray-100 flex flex-col h-screen sticky top-0 hidden md:flex">
            <div class="p-8">
                <div class="flex items-center gap-3 text-emerald-600 mb-8">
                    <div class="bg-emerald-100 p-2 rounded-xl">
                        <i data-lucide="zap" fill="currentColor"></i>
                    </div>
                    <span class="text-xl font-black tracking-tight text-gray-900">Scrol<span class="text-emerald-500">Less</span></span>
                </div>
                
                <nav class="space-y-1" id="desktop-nav">
                    <!-- Nav items rendered by JS -->
                </nav>
            </div>

            <div class="mt-auto p-6 border-t border-gray-50">
                <div class="bg-gradient-to-br from-gray-900 to-gray-800 rounded-2xl p-4 text-white">
                    <p class="text-xs text-gray-400 mb-1 font-medium uppercase">Zarobione</p>
                    <div class="flex items-center justify-between">
                        <span class="text-xl font-bold flex items-center gap-2">
                            <i data-lucide="hourglass" class="text-yellow-400 w-5 h-5"></i> 
                            <span id="sidebar-coins">0</span>
                        </span>
                        <div class="bg-white/10 p-1 rounded-lg">
                           <i data-lucide="trophy" class="text-yellow-400 w-4 h-4"></i>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col max-w-7xl mx-auto px-4 sm:px-8 py-8 pb-24 md:pb-8 overflow-y-auto">
            <header class="flex justify-between items-center mb-10">
                <div>
                    <h1 id="page-title" class="text-3xl font-black text-gray-900 capitalize">Dashboard</h1>
                    <p id="current-date" class="text-gray-500 mt-1"></p>
                </div>
                <div class="flex items-center gap-4">
                    <div class="hidden sm:flex items-center gap-2 bg-white px-4 py-2 rounded-full border border-gray-100 shadow-sm">
                        <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                        <span class="text-sm font-bold text-gray-700" id="streak-counter">0 dni streak</span>
                    </div>
                    <button onclick="setActiveTab('settings')" class="p-2.5 bg-white rounded-full border border-gray-100 shadow-sm text-gray-500 hover:text-emerald-600 transition-colors">
                        <i data-lucide="settings" class="w-5 h-5"></i>
                    </button>
                </div>
            </header>

            <div id="content-area" class="animate-fade-in">
                <!-- Content injected by JS -->
            </div>
        </main>

        <!-- MOBILE NAV -->
        <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-2 py-3 flex justify-between items-center z-50" id="mobile-nav">
            <!-- Mobile nav items rendered by JS -->
        </nav>
    </div>

    <!-- NUDGE MODAL -->
    <div id="nudge-modal" class="fixed inset-0 z-[100] bg-gray-900/80 backdrop-blur-md hidden items-center justify-center p-4">
        <div class="bg-white rounded-[3rem] p-12 max-w-xl w-full text-center shadow-2xl">
            <div class="w-24 h-24 bg-rose-100 text-rose-500 rounded-full flex items-center justify-center mx-auto mb-8">
                <i data-lucide="alert-triangle" class="w-12 h-12"></i>
            </div>
            <h2 class="text-4xl font-black text-gray-900 mb-4">STOP! Scroll Brake!</h2>
            <p class="text-gray-500 text-lg mb-10 leading-relaxed">
                Przekroczy≈Çe≈õ sw√≥j bezpieczny limit. Twoja koncentracja spada. <br/>
                Zr√≥b 5-minutowƒÖ przerwƒô offline, a odejmiemy 5 minut od Twojego licznika.
            </p>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="handleNudge(true)" class="bg-emerald-500 text-white font-bold py-4 rounded-2xl hover:bg-emerald-600 transition-all shadow-lg">Idƒô na spacer</button>
                <button onclick="handleNudge(false)" class="bg-gray-100 text-gray-500 font-bold py-4 rounded-2xl hover:bg-gray-200 transition-all">Ignoruj</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG & STATE ---
        const apiKey = ""; 
        let activeTab = 'dashboard';
        let state = {
            user: {
                screenTimeToday: 45,
                baseline: 180,
                dailyGoal: 120,
                coins: 466,
                streak: 5,
                timeSavedTotal: 420,
                history: [45, 120, 80, 160, 40, 50]
            },
            friends: [
                { id: 1, name: "Ty", avatar: "üë§", minutes: 45, goal: 120, trend: 'down', trendValue: 15 },
                { id: 2, name: "Kasia", avatar: "üë©", minutes: 90, goal: 100, trend: 'down', trendValue: 5 },
                { id: 3, name: "Marek", avatar: "üßî", minutes: 140, goal: 150, trend: 'up', trendValue: 10 },
                { id: 4, name: "Ola", avatar: "üë±‚Äç‚ôÄÔ∏è", minutes: 30, goal: 90, trend: 'down', trendValue: 30 },
            ],
            aiAdvice: null,
            isAiLoading: false
        };

        const REWARDS = [
            { id: 1, title: "Darmowa Matcha Latte", cost: 450, type: 'wellness', icon: 'leaf', gradient: "from-emerald-400 to-green-500", desc: "Odbierz w partnerskich kawiarniach." },
            { id: 2, title: "-30% na Ebooki", cost: 600, type: 'dev', icon: 'book-open', gradient: "from-blue-400 to-indigo-500", desc: "Wa≈ºne na topowe tytu≈Çy rozwojowe." },
            { id: 3, title: "Pierwsze zajƒôcia Pilates", cost: 800, type: 'sport', icon: 'wind', gradient: "from-rose-400 to-pink-500", desc: "-50% na wej≈õcie lub darmowe w karnecie." },
            { id: 4, title: "Dieta Pude≈Çkowa -15%", cost: 500, type: 'wellness', icon: 'salad', gradient: "from-orange-400 to-amber-500", desc: "Zadbaj o zdrowie, oszczƒôdzajƒÖc czas." },
            { id: 5, title: "Posad≈∫ Prawdziwe Drzewo", cost: 1000, type: 'charity', icon: 'heart', gradient: "from-green-500 to-teal-600", desc: "Wspieramy fundacjƒô Las Na Zawsze." },
            { id: 6, title: "Przegrany stawia pizzƒô", cost: 1200, type: 'social', icon: 'users', gradient: "from-violet-500 to-purple-600", desc: "Idealne do rywalizacji ze znajomymi." },
        ];

        const NAV_ITEMS = [
            { id: 'dashboard', label: 'Dashboard', icon: 'layout-dashboard' },
            { id: 'insights', label: 'Statystyki', icon: 'history' },
            { id: 'social', label: 'Grupa', icon: 'users' },
            { id: 'shop', label: 'Nagrody', icon: 'shopping-bag' },
            { id: 'alternatives', label: 'Odkryj', icon: 'compass' },
            { id: 'settings', label: 'Ustawienia', icon: 'settings' },
            { id: 'debug', label: 'Panel Debug', icon: 'pen-tool' },
        ];

        // --- CORE LOGIC ---

        function init() {
            document.getElementById('current-date').innerText = `Dzisiaj: ${new Date().toLocaleDateString('pl-PL', { weekday: 'long', day: 'numeric', month: 'long' })}`;
            renderNav();
            updateUI();
            
            // Check for nudge every minute
            setInterval(() => {
                if (state.user.screenTimeToday > state.user.dailyGoal + 30) {
                    document.getElementById('nudge-modal').style.display = 'flex';
                }
            }, 60000);
        }

        function updateUI() {
            // Update global elements
            document.getElementById('sidebar-coins').innerText = state.user.coins;
            document.getElementById('streak-counter').innerText = `${state.user.streak} dni streak`;
            document.getElementById('page-title').innerText = NAV_ITEMS.find(n => n.id === activeTab).label;
            
            // Render specific tab
            const contentArea = document.getElementById('content-area');
            contentArea.innerHTML = '';
            
            switch(activeTab) {
                case 'dashboard': renderDashboard(contentArea); break;
                case 'shop': renderShop(contentArea); break;
                case 'insights': renderInsights(contentArea); break;
                case 'social': renderSocial(contentArea); break;
                case 'alternatives': renderAlternatives(contentArea); break;
                case 'settings': renderSettings(contentArea); break;
                case 'debug': renderDebug(contentArea); break;
            }
            
            renderNav(); // Re-render nav to update active state
            lucide.createIcons();
        }

        function setActiveTab(tabId) {
            activeTab = tabId;
            updateUI();
        }

        function addTime(mins) {
            state.user.screenTimeToday = Math.max(0, state.user.screenTimeToday + mins);
            updateUI();
        }

        function handleNudge(success) {
            if (success) addTime(-5);
            document.getElementById('nudge-modal').style.display = 'none';
        }

        // --- RENDERING FUNCTIONS ---

        function renderNav() {
            const dNav = document.getElementById('desktop-nav');
            const mNav = document.getElementById('mobile-nav');
            
            dNav.innerHTML = NAV_ITEMS.map(item => `
                <button onclick="setActiveTab('${item.id}')" class="w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group ${activeTab === item.id ? 'bg-emerald-50 text-emerald-600 font-bold shadow-sm' : 'text-gray-500 hover:bg-gray-50 hover:text-gray-900'}">
                    <i data-lucide="${item.icon}" class="w-5 h-5"></i>
                    ${item.label}
                </button>
            `).join('');

            mNav.innerHTML = NAV_ITEMS.slice(0, 5).map(item => `
                <button onclick="setActiveTab('${item.id}')" class="flex flex-col items-center flex-1 ${activeTab === item.id ? 'text-emerald-600' : 'text-gray-400'}">
                    <i data-lucide="${item.icon}" class="w-5 h-5"></i>
                    <span class="text-[10px] mt-1">${item.label}</span>
                </button>
            `).join('');
        }

        function renderDashboard(container) {
            const progress = Math.min(state.user.screenTimeToday / state.user.dailyGoal, 1);
            const isOver = state.user.screenTimeToday > state.user.dailyGoal;
            const dashOffset = 2 * Math.PI * 110 * (1 - progress);

            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <section class="lg:col-span-2 bg-white rounded-[2.5rem] p-10 shadow-xl shadow-gray-200/50 border border-gray-50 relative overflow-hidden">
                       <div class="flex flex-col md:flex-row items-center gap-12">
                          <div class="relative w-64 h-64 shrink-0">
                            <svg class="w-full h-full transform -rotate-90 drop-shadow-sm">
                              <circle cx="128" cy="128" r="110" stroke="#f1f5f9" stroke-width="16" fill="transparent" />
                              <circle cx="128" cy="128" r="110" stroke="currentColor" stroke-width="16" fill="transparent" 
                                stroke-dasharray="691.15" stroke-dashoffset="${dashOffset}" stroke-linecap="round"
                                class="${isOver ? 'text-rose-500' : 'text-emerald-500'} transition-all duration-1000" />
                            </svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center text-center">
                               <span class="text-4xl font-black text-gray-900">${Math.floor(state.user.screenTimeToday/60)}h ${state.user.screenTimeToday % 60}m</span>
                               <span class="text-gray-400 text-sm font-medium">cel: ${Math.floor(state.user.dailyGoal/60)}h</span>
                            </div>
                          </div>
                          <div class="flex-1 space-y-6 text-center md:text-left">
                             <h2 class="text-2xl font-bold text-gray-800">Jak Ci idzie dzisiaj?</h2>
                             <p class="text-gray-500 leading-relaxed">${isOver ? "Limit przekroczony. Pora na cyfrowy detoks." : "Dobry balans! Wykorzystujesz technologiƒô mƒÖdrze."}</p>
                             <div class="flex flex-wrap justify-center md:justify-start gap-4 pt-4">
                                <div class="bg-emerald-50 px-5 py-3 rounded-2xl text-center">
                                   <p class="text-[10px] text-emerald-600 font-bold uppercase tracking-wider mb-1">Baseline</p>
                                   <p class="text-xl font-black text-emerald-900">${state.user.baseline}m</p>
                                </div>
                                <div class="bg-indigo-50 px-5 py-3 rounded-2xl text-center">
                                   <p class="text-[10px] text-indigo-600 font-bold uppercase tracking-wider mb-1">Odzyskane</p>
                                   <p class="text-xl font-black text-indigo-900">${Math.floor(state.user.timeSavedTotal/60)}h</p>
                                </div>
                             </div>
                          </div>
                       </div>
                    </section>
                    <div class="space-y-8">
                       <div class="bg-gradient-to-br from-violet-600 to-indigo-700 rounded-[2rem] p-8 text-white shadow-lg">
                          <h3 class="font-bold text-lg mb-4 flex items-center gap-2"><i data-lucide="sparkles"></i> Zen Bot AI</h3>
                          <div class="bg-white/10 backdrop-blur-md rounded-2xl p-4 min-h-[100px] flex items-center mb-6">
                             <p id="ai-advice-box" class="text-sm italic font-medium leading-relaxed">${state.aiAdvice || "Potrzebujesz motywacji? Kliknij przycisk!"}</p>
                          </div>
                          <button onclick="getAiAdvice()" class="w-full bg-white text-indigo-600 font-bold py-3 rounded-xl hover:bg-indigo-50 transition-all shadow-md">Analizuj stan</button>
                       </div>
                    </div>
                </div>
            `;
        }

        async function getAiAdvice() {
            const box = document.getElementById('ai-advice-box');
            box.innerText = "≈ÅƒÖczenie z duchem cyfrowym...";
            try {
                const prompt = `Jeste≈õ Zen Botem. U≈ºytkownik ma ${state.user.screenTimeToday} min ekranu dzisiaj (cel: ${state.user.dailyGoal}). Streak: ${state.user.streak}. Daj kr√≥tkƒÖ, zabawnƒÖ poradƒô po polsku (max 2 zdania).`;
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                state.aiAdvice = data.candidates?.[0]?.content?.parts?.[0]?.text || "Z≈Çap g≈Çƒôboki oddech!";
                box.innerText = state.aiAdvice;
            } catch(e) {
                box.innerText = "B≈ÇƒÖd AI. Po prostu od≈Ç√≥≈º to urzƒÖdzenie! üòâ";
            }
        }

        function renderShop(container) {
            container.className = "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6";
            container.innerHTML = REWARDS.map(reward => {
                const canBuy = state.user.coins >= reward.cost;
                return `
                    <div class="bg-white rounded-[2rem] overflow-hidden border border-gray-100 shadow-sm hover:shadow-xl transition-all group">
                        <div class="h-32 bg-gradient-to-br ${reward.gradient} flex items-center justify-center">
                            <div class="bg-white/20 p-4 rounded-3xl backdrop-blur-md group-hover:scale-110 transition-transform">
                                <i data-lucide="${reward.icon}" class="text-white w-8 h-8"></i>
                            </div>
                        </div>
                        <div class="p-8">
                            <span class="text-[10px] font-black uppercase text-gray-400 tracking-widest">${reward.type}</span>
                            <h3 class="text-xl font-bold text-gray-900 mt-1 mb-2">${reward.title}</h3>
                            <p class="text-sm text-gray-500 mb-6">${reward.desc}</p>
                            <div class="flex items-center justify-between">
                               <span class="flex items-center gap-1 font-black text-xl ${canBuy ? 'text-emerald-600' : 'text-gray-400'}">
                                  <i data-lucide="hourglass" class="w-5 h-5"></i> ${reward.cost}
                               </span>
                               <button onclick="buyReward(${reward.cost})" ${!canBuy ? 'disabled' : ''} 
                                class="px-6 py-3 rounded-2xl font-bold transition-all shadow-sm ${canBuy ? 'bg-gray-900 text-white hover:bg-emerald-600' : 'bg-gray-100 text-gray-400 cursor-not-allowed'}">
                                 Odbierz
                               </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function buyReward(cost) {
            if (state.user.coins >= cost) {
                state.user.coins -= cost;
                triggerConfetti();
                updateUI();
            }
        }

        function renderInsights(container) {
            const history = [...state.user.history, state.user.screenTimeToday];
            container.innerHTML = `
                <div class="bg-white rounded-[2.5rem] p-10 border border-gray-100 shadow-sm">
                   <h3 class="text-2xl font-bold text-gray-900 mb-10 text-center">Ostatnie 7 dni</h3>
                   <div class="flex items-end justify-between h-64 gap-4">
                      ${history.map((val, i) => `
                        <div class="flex-1 flex flex-col items-center group relative">
                           <div class="absolute bottom-full mb-2 opacity-0 group-hover:opacity-100 bg-gray-900 text-white text-[10px] px-2 py-1 rounded-lg transition-all">${val} min</div>
                           <div class="w-full rounded-2xl transition-all duration-700 ${val > state.user.dailyGoal ? 'bg-rose-400' : 'bg-emerald-400'}" style="height: ${Math.max(10, (val/300)*100)}%"></div>
                           <span class="text-[10px] sm:text-xs font-bold text-gray-400 mt-4">${['Pn', 'Wt', '≈ör', 'Cz', 'Pt', 'So', 'Nd'][i] || 'Dzi≈õ'}</span>
                        </div>
                      `).join('')}
                   </div>
                </div>
            `;
        }

        function renderSocial(container) {
            container.innerHTML = `
                <div class="max-w-4xl mx-auto w-full bg-white rounded-[2.5rem] shadow-sm border border-gray-100 p-10">
                    <h3 class="text-2xl font-bold mb-10">Ranking Grupy</h3>
                    <div class="space-y-4">
                        ${state.friends.sort((a,b)=>a.minutes-b.minutes).map((f, i) => `
                            <div class="flex items-center gap-6 p-6 bg-gray-50 rounded-[1.5rem] hover:bg-white hover:shadow-lg transition-all group">
                                <span class="text-xl font-black text-gray-300 w-8">${i+1}.</span>
                                <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center text-3xl shadow-sm border border-gray-100">${f.avatar}</div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-900 text-lg">${f.name}</h4>
                                    <div class="flex items-center gap-2 mt-1">
                                        <div class="w-32 h-2 bg-gray-200 rounded-full overflow-hidden">
                                            <div class="h-full ${f.minutes > f.goal ? 'bg-rose-400' : 'bg-emerald-400'}" style="width: ${(f.minutes/f.goal)*100}%"></div>
                                        </div>
                                        <span class="text-xs font-bold text-gray-400">${f.minutes}m / ${f.goal}m</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderAlternatives(container) {
            container.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-gradient-to-r from-rose-500 to-orange-400 rounded-[2.5rem] p-10 text-white shadow-xl shadow-rose-100">
                        <h2 class="text-4xl font-black mt-4 mb-2">Koncert Plenerowy</h2>
                        <p class="opacity-90 mb-8 max-w-sm">Plac Wolno≈õci, 19:30. Idealna okazja, aby schowaƒá telefon i poczuƒá muzykƒô.</p>
                        <button class="bg-white text-rose-600 font-bold px-8 py-4 rounded-2xl shadow-lg">Dowiedz siƒô wiƒôcej</button>
                    </div>
                    <div class="bg-white rounded-[2.5rem] p-10 border border-gray-100 shadow-sm">
                        <h3 class="text-2xl font-bold mb-6">Wydarzenia offline</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-gray-50 rounded-2xl flex items-center gap-4">
                                <div class="text-3xl">üßò‚Äç‚ôÄÔ∏è</div>
                                <div><h4 class="font-bold">Joga w Parku</h4><p class="text-xs text-gray-400">Dzisiaj 18:00 ‚Ä¢ Cytadela</p></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderSettings(container) {
            container.innerHTML = `
                <div class="max-w-xl mx-auto bg-white p-10 rounded-[2.5rem] border border-gray-100">
                    <h3 class="text-xl font-bold mb-8">Ustawienia celu</h3>
                    <div class="space-y-4">
                        <label class="block text-sm font-medium text-gray-700">Tw√≥j dzienny limit (minuty)</label>
                        <input type="number" value="${state.user.dailyGoal}" onchange="state.user.dailyGoal = parseInt(this.value); updateUI();" class="w-full border border-gray-200 rounded-xl p-3 focus:ring-2 focus:ring-emerald-500 outline-none">
                    </div>
                </div>
            `;
        }

        function renderDebug(container) {
            container.innerHTML = `
                <div class="max-w-xl mx-auto bg-gray-900 text-white p-10 rounded-[2.5rem] shadow-2xl">
                    <h3 class="text-xl font-bold mb-8">Panel Symulacji</h3>
                    <div class="space-y-6">
                        <button onclick="addTime(15)" class="w-full py-3 bg-emerald-600 rounded-xl font-bold">+15 min czasu</button>
                        <button onclick="addTime(-15)" class="w-full py-3 bg-rose-600 rounded-xl font-bold">-15 min czasu</button>
                        <button onclick="state.user.coins += 100; updateUI();" class="w-full py-3 bg-yellow-600 rounded-xl font-bold">+100 monet</button>
                    </div>
                </div>
            `;
        }

        // --- UTILS: CONFETTI ---
        function triggerConfetti() {
            const canvas = document.getElementById('confetti');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const particles = [];
            const colors = ['#FCD34D', '#F87171', '#60A5FA', '#34D399', '#A78BFA'];
            for (let i = 0; i < 150; i++) {
                particles.push({
                    x: canvas.width / 2, y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 20, vy: (Math.random() - 0.5) * 20,
                    life: 100, color: colors[Math.floor(Math.random() * colors.length)],
                    size: Math.random() * 5 + 2
                });
            }
            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                let alive = false;
                particles.forEach(p => {
                    if (p.life > 0) {
                        alive = true; p.x += p.vx; p.y += p.vy; p.life--; p.vy += 0.2; p.size *= 0.96;
                        ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                        ctx.fillStyle = p.color; ctx.fill();
                    }
                });
                if (alive) requestAnimationFrame(animate);
            }
            animate();
        }

        window.onload = init;
    </script>
</body>
</html>
